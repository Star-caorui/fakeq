<!doctype html>
<html lang="zh-cmn-Hans">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no" />
  <meta name="renderer" content="webkit" />
  <meta name="force-rendering" content="webkit" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <!-- Module: CSS -->
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/mdui/1.0.2/css/mdui.min.css"
    integrity="sha512-Hh2syGXSuZabqBNcdvPiGo67ASyKhlKTZV9lLOmJp10qZ1v8/YPeuZBoOh0WmS/UPwWtRzQhNJfYyKDAhdGocQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>Fakeq</title>
</head>

<body class="mdui-theme-layout-auto mdui-theme-primary-white mdui-theme-accent-blue">
  <div class="mdui-appbar mdui-text-color-theme">
    <div class="mdui-toolbar">
      <button id="sidebar_button" class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#sidebar', overlay: false}">
        <i class="mdui-icon">
          <ion-icon name="menu-outline"></ion-icon>
        </i>
      </button>
      <span class="mdui-typo-title">Fakeq</span>
      <div class="mdui-toolbar-spacer"></div>
      <button id="search_button" class="mdui-btn mdui-btn-icon">
        <i class="mdui-icon mdui-text-color-theme-icon">
          <ion-icon name="search-outline"></ion-icon>
        </i>
      </button>
      <button id="refresh_button" class="mdui-btn mdui-btn-icon">
        <i class="mdui-icon mdui-text-color-theme-icon">
          <ion-icon name="refresh-outline"></ion-icon>
        </i>
      </button>
      <button class="mdui-btn mdui-btn-icon">
        <i class="mdui-icon mdui-text-color-theme-icon">
          <ion-icon name="ellipsis-vertical-outline"></ion-icon>
        </i>
      </button>
    </div>

    <!-- Module: 侧边栏 -->
    <div id="sidebar" class="mdui-drawer mdui-drawer-close mdui-color-theme-100">
      <div class="mdui-list">
        <div class="mdui-card-header">
          <img id="self_logo" class="mdui-card-header-avatar" src="" loading="lazy" />
          <div id="self_name" class="mdui-card-header-title"></div>
          <div id="self_slogan" class="mdui-card-header-subtitle"></div>
        </div>
        <div class="mdui-divider"></div>
        <a class="mdui-list-item mdui-ripple">
          <i class="mdui-list-item-icon mdui-icon mdui-text-color-theme-icon">
            <ion-icon name="person-outline"></ion-icon>
          </i>
          <div class="mdui-list-item-content">我的帐号</div>
        </a>
        <a class="mdui-list-item mdui-ripple">
          <i class="mdui-list-item-icon mdui-icon mdui-text-color-theme-icon">
            <ion-icon name="options-outline"></ion-icon>
          </i>
          <div class="mdui-list-item-content">偏好设置</div>
        </a>
      </div>
    </div>

    <!-- Module: 顶部 Tab 栏 -->
    <div class="mdui-tab mdui-tab-full-width" mdui-tab>
      <a id="chat_button" href="#chat" class="mdui-ripple">消息</a>
      <a id="people_button" href="#people" class="mdui-ripple">联系人</a>
      <a id="qqzone_button" href="#qqzone" class="mdui-ripple mdui-hidden">动态</a>
    </div>
  </div>

  <!-- Module: 消息 -->
  <div id="chat">
    <div id="chat-list"
      class="mdui-list mdui-p-r-1 mdui-col-xs-12  mdui-col-sm-4 mdui-col-md-3 mdui-col-lg-2 mdui-col-xl-2">
      <div class="mdui-list-item mdui-ripple">
        <div class="mdui-list-item-avatar">
          <img src="https://q1.qlogo.cn/g?b=qq&s=640&nk=2549309641" />
        </div>
        <div class="mdui-list-item-content">
          <div class="mdui-list-item-title">今夕何夕</div>
          <div class="mdui-list-item-text mdui-list-item-one-line">
            这个样式可以吗？
          </div>
        </div>
      </div>
      <div class="mdui-list-item mdui-ripple">
        <div class="mdui-list-item-avatar">
          <img src="https://q1.qlogo.cn/g?b=qq&s=640&nk=1239504152" />
        </div>
        <div class="mdui-list-item-content">
          <div class="mdui-list-item-title">云山鸦</div>
          <div class="mdui-list-item-text mdui-list-item-one-line">
            有点不太行
          </div>
        </div>
      </div>
      <div class="mdui-list-item mdui-ripple">
        <div class="mdui-list-item-avatar">
          <img src="https://q1.qlogo.cn/g?b=qq&s=640&nk=1370879951" />
        </div>
        <div class="mdui-list-item-content">
          <div class="mdui-list-item-title">神様は居るの？</div>
          <div class="mdui-list-item-text mdui-list-item-one-line">
            确实
          </div>
        </div>
      </div>
    </div>
    <div id="chat-area" style="height: 30vh;">
      <div class="mdui-list mdui-p-l-1 mdui-hidden-xs mdui-col-sm-8 mdui-col-md-9 mdui-col-lg-10 mdui-col-xl-10">
        <div class="mdui-list-item">
          <div class="mdui-list-item-avatar">
            <img src="https://q1.qlogo.cn/g?b=qq&s=640&nk=1239504152" />
          </div>
          <div class="mdui-list-item-content">
            <div class="mdui-list-item-title">云山鸦</div>
            <div class="mdui-list-item-text mdui-list-item-one-line">
              有点不太行
            </div>
          </div>
          <button class="mdui-btn mdui-btn-icon mdui-ripple">
            <i class="mdui-icon mdui-text-color-theme-icon">
              <ion-icon name="ellipsis-vertical-outline"></ion-icon>
            </i>
          </button>
        </div>
        <div class="mdui-p-x-2" style="height: calc(100vh  - 357px); overflow-y:scroll;">
          <div style="height: 10000px;"></div>
        </div>
        <div class="mdui-p-x-2">
          <button class="mdui-btn mdui-btn-icon mdui-ripple">
            <i class="mdui-icon mdui-text-color-theme-icon">
              <ion-icon name="folder-outline"></ion-icon>
            </i>
          </button>
          <button class="mdui-btn mdui-btn-icon mdui-ripple">
            <i class="mdui-icon mdui-text-color-theme-icon">
              <ion-icon name="image-outline"></ion-icon>
            </i>
          </button>
          <button class="mdui-btn mdui-ripple mdui-float-right">发送</button>
          <button class="mdui-btn mdui-btn-icon mdui-ripple mdui-float-right">
            <i class="mdui-icon mdui-text-color-theme-icon">
              <ion-icon name="happy-outline"></ion-icon>
            </i>
          </button>
          <div class="mdui-textfield">
            <div class="mdui-divider"></div>
            <textarea class="mdui-textfield-input" rows="4" placeholder="Type Message"></textarea>
          </div>
        </div>
      </div>
      <div class="mdui-list mdui-hidden-sm-up">
        小屏幕该用的方法
      </div>
    </div>
  </div>

  <!-- Module: 联系人 -->
  <div id="people" class="mdui-p-a-2">
    <div id="newFriend_button" class="mdui-list-item mdui-ripple" mdui-dialog="{target: '#newFriend'}">
      <div class="mdui-list-item-content">新朋友</div>
      <i class="mdui-icon">
        <ion-icon name="chevron-forward-outline"></ion-icon>
      </i>
    </div>
    <div id="groupNotification_button" class="mdui-list-item mdui-ripple" mdui-dialog="{target: '#groupNotification'}">
      <div class="mdui-list-item-content">群通知</div>
      <i class="mdui-icon">
        <ion-icon name="chevron-forward-outline"></ion-icon>
      </i>
    </div>
    <!-- Module: 新朋友 -->
    <div id="newFriend" class="mdui-dialog">
      <div class="mdui-dialog-content">
        <div class="mdui-dialog-title">
          申请列表
          <button class="mdui-btn mdui-btn-icon mdui-float-right mdui-ripple" mdui-dialog-close>
            <i class="mdui-icon">
              <ion-icon name="close-outline"></ion-icon>
            </i>
          </button>
        </div>
        <div id="newFriend-list"></div>
      </div>
    </div>
    <!-- Module: 群通知 -->
    <div id="groupNotification" class="mdui-dialog">
      <div class="mdui-dialog-content">
        <div class="mdui-dialog-title">
          群通知
          <button class="mdui-btn mdui-btn-icon mdui-float-right mdui-ripple" mdui-dialog-close>
            <i class="mdui-icon">
              <ion-icon name="close-outline"></ion-icon>
            </i>
          </button>
        </div>
        <div id="groupNotification-list">
          <div class="mdui-list-item">
            <div class="mdui-list-item-avatar">
              <img src="https://p.qlogo.cn/gh/1039477758/1039477758/" />
            </div>
            <div class="mdui-list-item-content">
              <div class="mdui-list-item-title">测试群聊 1</div>
              <div class="mdui-list-item-text mdui-list-item-one-line">
                已被群主解散
              </div>
              <div class="mdui-list-item-text mdui-list-item-one-line">
                处理人：Star_caorui
              </div>
            </div>
            <button class="mdui-btn mdui-btn-icon mdui-ripple">
              <i class="mdui-icon">
                <ion-icon name="close-outline"></ion-icon>
              </i>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Module: 联系人 Tab 栏 -->
    <div class="mdui-tab mdui-tab-full-width" mdui-tab>
      <a id="friend_button" href="#friend" class="mdui-ripple">好友</a>
      <a id="friendClassify_button" href="#friend-classify" class="mdui-ripple mdui-hidden">分组</a>
      <a id="group_button" href="#group" class="mdui-ripple">群聊</a>
    </div>
    <!-- Module: 我的好友 -->
    <div id="friend" class="mdui-p-a-2">
      <ul id="friend-list" class="mdui-list"></ul>
    </div>
    <!-- Module: 好友分组 -->
    <!-- TODO: 好友分组 有待重构 -->
    <div id="friend-classify" class="mdui-p-a-2">
      <ul class="mdui-list" mdui-collapse="{accordion: true}">
        <li class="mdui-collapse-item">
          <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
            <i class="mdui-collapse-item-arrow mdui-list-item-icon mdui-icon">
              <ion-icon name="chevron-forward-outline"></ion-icon>
            </i>
            <div class="mdui-list-item-content">我的好友</div>
            <div class="">1/1</div>
          </div>
          <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
            <div class="mdui-card-header mdui-ripple">
              <img class="mdui-card-header-avatar" src="https://q1.qlogo.cn/g?b=qq&s=640&nk=2549309641" loading="lazy" />
              <div class="mdui-card-header-title mdui-text-color-theme-text">Star_caorui</div>
              <div class="mdui-card-header-subtitle mdui-text-color-theme-text">这里是个性签名！</div>
            </div>
            <div class="mdui-card-header mdui-ripple">
              <img class="mdui-card-header-avatar" src="https://q1.qlogo.cn/g?b=qq&s=640&nk=1239504152" loading="lazy" />
              <div class="mdui-card-header-title mdui-text-color-theme-text">云山鸦</div>
              <div class="mdui-card-header-subtitle mdui-text-color-theme-text">这里是个性签名！</div>
            </div>
            <div class="mdui-card-header mdui-ripple">
              <img class="mdui-card-header-avatar" src="https://q1.qlogo.cn/g?b=qq&s=640&nk=1370879951" loading="lazy" />
              <div class="mdui-card-header-title mdui-text-color-theme-text">神様は居るの？</div>
              <div class="mdui-card-header-subtitle mdui-text-color-theme-text">这里是个性签名！</div>
            </div>
          </div>
        </li>
        <li class="mdui-collapse-item">
          <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
            <i class="mdui-collapse-item-arrow mdui-list-item-icon mdui-icon">
              <ion-icon name="chevron-forward-outline"></ion-icon>
            </i>
            <div class="mdui-list-item-content">测试分组</div>
            <div class="">1/1</div>
          </div>
          <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
            <div class="mdui-card-header mdui-ripple">
              <img class="mdui-card-header-avatar" src="https://q1.qlogo.cn/g?b=qq&s=640&nk=2549309641" loading="lazy" />
              <div class="mdui-card-header-title mdui-text-color-theme-text">Star_caorui</div>
              <div class="mdui-card-header-subtitle mdui-text-color-theme-text">这里是个性签名！</div>
            </div>
            <div class="mdui-card-header mdui-ripple">
              <img class="mdui-card-header-avatar" src="https://q1.qlogo.cn/g?b=qq&s=640&nk=1239504152" loading="lazy" />
              <div class="mdui-card-header-title mdui-text-color-theme-text">云山鸦</div>
              <div class="mdui-card-header-subtitle mdui-text-color-theme-text">这里是个性签名！</div>
            </div>
            <div class="mdui-card-header mdui-ripple">
              <img class="mdui-card-header-avatar" src="https://q1.qlogo.cn/g?b=qq&s=640&nk=1370879951" loading="lazy" />
              <div class="mdui-card-header-title mdui-text-color-theme-text">神様は居るの？</div>
              <div class="mdui-card-header-subtitle mdui-text-color-theme-text">这里是个性签名！</div>
            </div>
          </div>
        </li>
      </ul>
    </div>
    <!-- Module: 我的群聊 -->
    <div id="group" class="mdui-p-a-2">
      <ul id="group-list" class="mdui-list" mdui-collapse="{accordion: true}"></ul>
    </div>
  </div>
  <!-- Module: QQ空间 -->
  <!-- TODO: QQ 空间 有待重构 -->
  <div id="qqzone" class="mdui-p-a-2">
    <div class="mdui-container-fluid mdui-row">
      <div class="mdui-col-xs-12  mdui-col-sm-6 mdui-col-md-4 mdui-col-lg-3 mdui-col-xl-2">
        <div class="mdui-card mdui-m-y-1">
          <div class="mdui-card-header">
            <img class="mdui-card-header-avatar" src="https://q1.qlogo.cn/g?b=qq&s=640&nk=2549309641" />
            <div class="mdui-card-header-title">Star_caorui</div>
            <div class="mdui-card-header-subtitle">今天 2:30</div>
          </div>
          <div class="mdui-card-menu">
            <button class="mdui-btn mdui-btn-icon mdui-ripple">
              <i class="mdui-icon">
                <ion-icon name="ellipsis-horizontal-outline"></ion-icon>
              </i>
            </button>
          </div>
          <div class="mdui-card-content">为什么我要写这个功能？？？</div>
          <div class="mdui-card-actions">
            <div>
              <div class="mdui-chip">
                <span class="mdui-chip-title">Star_caorui</span>
              </div>
              <div class="mdui-chip">
                <span class="mdui-chip-title">云山鸦</span>
              </div>
              <div class="mdui-chip">
                <span class="mdui-chip-title">神様は居るの？</span>
              </div>
              觉得很淦
            </div>
            <button class="mdui-btn mdui-btn-icon mdui-float-right mdui-ripple">
              <i class="mdui-icon">
                <ion-icon name="share-outline"></ion-icon>
              </i>
            </button>
            <button class="mdui-btn mdui-btn-icon mdui-float-right mdui-ripple">
              <i class="mdui-icon">
                <ion-icon name="chatbox-ellipses-outline"></ion-icon>
              </i>
            </button>
            <button class="mdui-btn mdui-btn-icon mdui-float-right mdui-ripple">
              <i class="mdui-icon">
                <ion-icon name="thumbs-up-outline"></ion-icon>
              </i>
            </button>
          </div>
        </div>
      </div>
      <div class="mdui-col-xs-12  mdui-col-sm-6 mdui-col-md-4 mdui-col-lg-3 mdui-col-xl-2">
        <div class="mdui-card mdui-m-y-1">
          <div class="mdui-card-header">
            <img class="mdui-card-header-avatar" src="https://q1.qlogo.cn/g?b=qq&s=640&nk=2549309641" />
            <div class="mdui-card-header-title">Star_caorui</div>
            <div class="mdui-card-header-subtitle">今天 2:30</div>
          </div>
          <div class="mdui-card-menu">
            <button class="mdui-btn mdui-btn-icon mdui-ripple">
              <i class="mdui-icon">
                <ion-icon name="ellipsis-horizontal-outline"></ion-icon>
              </i>
            </button>
          </div>
          <div class="mdui-card-content">为什么我要写这个功能？？？</div>
          <div class="mdui-card-actions">
            <div>
              <div class="mdui-chip">
                <span class="mdui-chip-title">Star_caorui</span>
              </div>
              <div class="mdui-chip">
                <span class="mdui-chip-title">云山鸦</span>
              </div>
              <div class="mdui-chip">
                <span class="mdui-chip-title">神様は居るの？</span>
              </div>
              觉得很淦
            </div>
            <button class="mdui-btn mdui-btn-icon mdui-float-right mdui-ripple">
              <i class="mdui-icon">
                <ion-icon name="share-outline"></ion-icon>
              </i>
            </button>
            <button class="mdui-btn mdui-btn-icon mdui-float-right mdui-ripple">
              <i class="mdui-icon">
                <ion-icon name="chatbox-ellipses-outline"></ion-icon>
              </i>
            </button>
            <button class="mdui-btn mdui-btn-icon mdui-float-right mdui-ripple">
              <i class="mdui-icon">
                <ion-icon name="thumbs-up-outline"></ion-icon>
              </i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Module: JavaScript -->
  <script
    src="https://cdn.bootcdn.net/ajax/libs/mdui/1.0.2/js/mdui.min.js"
    integrity="sha512-LBh0vC8hNru7991yk7vBb3tiBCU41shGOowGRnLqz63KYedvNQOyGOKHnl/pHSRYJ2P45bjzALArvDDHSSc2KA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="module"
    src="https://cdn.bootcdn.net/ajax/libs/ionicons/6.0.1/ionicons/ionicons.esm.min.js"
    integrity="sha512-6dpLw00u76bId3OXfrMDT2mpSlzfDRx5htyA9l3O4CkjH8Dr25yKH3ndAgQhgPQogRNzNL/HqxUzBLQKvRJSxg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script nomodule
    src="https://cdn.bootcdn.net/ajax/libs/ionicons/6.0.1/ionicons.min.js"
    integrity="sha512-esqkwbZWQWGPKMg0apElthYF54n7TMcMGQs/rC8KyWIjuFt+d+kB2n4j7yWOXGn82wMrs5rLMPoiw7n73GJ5Nw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    var $ = mdui.$;

    if (!localStorage.getItem("backend")) {
      mdui.dialog({
        title: '您尚未选择后端服务',
        content: 'Fakeq 支持 oicq, cq-http 两种不同的后端服务，请选择您的后端服务',
        buttons: [
          {
            text: 'oicq（推荐）',
            onClick: function (inst) {
              localStorage.setItem("backend", "oicq");
              location.reload();
              throw new Error('exit');
            }
          },
          {
            text: 'go-cqhttp',
            onClick: function (inst) {
              localStorage.setItem("backend", "go-cqhttp");
              location.reload();
              throw new Error('exit');
            }
          }
        ]
      });
    }

    backend = localStorage.getItem("backend");
    switch (backend) {
      case "oicq":
        var ws   = new WebSocket('ws://localhost:5700');
        var http = 'http://localhost:5700';
        break;

      case "go-cqhttp":
        var ws = new WebSocket('ws://localhost:6700');
        var http = 'http://localhost:5700';
        break;

      default:
        if (localStorage.getItem("backend")) {
          mdui.alert("您的后端服务配置错误，请重新配置", "错误");
          localStorage.removeItem('backend');
          location.reload();
          throw new Error('exit');
        }
        break;
    }
  </script>
  <script>
    $(function () {
      Notification.requestPermission(function (status) {
        // 这将使我们能在 Chrome/Safari 中使用 Notification.permission
        if (Notification.permission !== status) {
          Notification.permission = status;
        }
      });
    });
  </script>
  <script>
    function errConnect() {
      mdui.alert('请检查您的后端工作是否正常', '后端通信异常');
    }

    function getUserLogo(number) {
      return 'https://q1.qlogo.cn/g?b=qq&s=640&nk=' + number;
    }

    function getGroupLogo(number) {
      return 'https://p.qlogo.cn/gh/' + number + '/' + number + '/0';
    }

    function get_login_info() {
      $.ajax({
        method: 'POST',
        url: http + '/get_login_info',
        data: {
          params: ''
        },
        success: function (data) {
          data = JSON.parse(data);
          console.log(data);
          if (data.status === 'ok') {
            $('#self_logo').attr({ src: getUserLogo(data.data.user_id) });
            $('#self_name').text(data.data.nickname);
            $('#self_slogan').text('暂不支持设置个性签名');
          }
          delete data;
        }
      });
    }

    // TODO: 消息页面功能待完成

    function set_friend_add_request(flag, approve) {
      $.ajax({
        method: 'POST',
        url: http + '/set_friend_add_request',
        data: {
          flag: flag,
          approve: approve
        }
      });
    }

    function set_group_add_request(flag, sub_type, approve) {
      $.ajax({
        method: 'POST',
        url: http + '/set_group_add_request',
        data: {
          flag: flag,
          sub_type: sub_type,
          approve: approve
        }
      });
    }

    function get_system_msg() {
      $.ajax({
        method: 'POST',
        url: http + '/get_system_msg',
        data: {
          params: ''
        },
        success: function (data) {
          data = JSON.parse(data);
          console.log(data);
          if (data.status === 'ok') {
            $('#newFriend-list').empty();
            $('#groupNotification-list').empty();
            for (let i in data.data) {
              console.log(data.data[i]);
              if (data.data[i].request_type === 'friend') {
                $('#newFriend-list').append('<div class="mdui-list-item" flag="' + data.data[i]['flag'] + '"><div class="mdui-list-item-avatar"><img src="' + getUserLogo(data.data[i]['user_id']) + '"></div><div class="mdui-list-item-content"><div class="mdui-list-item-title">' + data.data[i]['nickname'] + ' (' + data.data[i]['user_id'] + ')</div><div class="mdui-list-item-text mdui-list-item-one-line">对方留言：' + data.data[i]['comment'] + '</div><div class="mdui-list-item-text mdui-list-item-one-line">来源：' + data.data[i]['source'] + '</div></div><button class="mdui-btn mdui-btn-icon mdui-ripple" approve="true"><i class="mdui-icon"><ion-icon name="checkmark-outline"></ion-icon></i></button> <button class="mdui-btn mdui-btn-icon mdui-ripple" approve="false"><i class="mdui-icon"><ion-icon name="close-outline"></ion-icon></i></button></div>');

              }
              if (data.data[i].request_type === 'group') {
                $('#groupNotification-list').append('<div class="mdui-list-item" flag="' + data.data[i]['flag'] + '" sub_type="' + data.data[i]['sub_type'] + '"><div class="mdui-list-item-avatar"><img src="' + getGroupLogo(data.data[i]['group_id']) + '"></div><div class="mdui-list-item-content"><div class="mdui-list-item-title">' + data.data[i]['group_name'] + ' (' + data.data[i]['group_id'] + ')</div><div class="mdui-list-item-text mdui-list-item-one-line">您收到了来自 "' + data.data[i]['nickname'] + '" (' + data.data[i]['user_id'] + ') 的邀请</div></div><button class="mdui-btn mdui-btn-icon mdui-ripple" approve="true"><i class="mdui-icon"><ion-icon name="checkmark-outline"></ion-icon></i></button> <button class="mdui-btn mdui-btn-icon mdui-ripple" approve="false"><i class="mdui-icon"><ion-icon name="close-outline"></ion-icon></i></button></div>');
              }
            }
            $('#newFriend-list div button').on('click', function (e) {
              set_friend_add_request($(this).parent().attr('flag'), $(this).attr('approve'));
              $(this).parent().remove();
              mdui.snackbar({
                message: '您已' + ($(this).attr('approve') === 'true' ? '同意' : '拒绝') + '了对方的好友请求',
                position: 'right-bottom',
              });
            });
            $('#groupNotification-list div button').on('click', function (e) {
              set_group_add_request($(this).parent().attr('flag'), $(this).parent().attr('sub_type'), $(this).attr('approve'));
              $(this).parent().remove();
              mdui.snackbar({
                message: '您已' + ($(this).attr('approve') === 'true' ? '同意' : '拒绝') + '了对方的邀请',
                position: 'right-bottom',
              });
            });
          }
          delete data;
        }
      });
    }

    function get_friend_list() {
      $.ajax({
        method: 'POST',
        url: http + '/get_friend_list',
        data: {
          params: ''
        },
        success: function (data) {
          data = JSON.parse(data);
          console.log(data);
          if (data.status === 'ok') {
            $('#friend-list').empty();
            for (let i in data.data) {
              $('#friend-list').append('<li class="mdui-list-item mdui-ripple"><div class="mdui-list-item-avatar"><img src="' + getUserLogo(data.data[i]['user_id']) + '" /></div><div class="mdui-list-item-content"><div class="mdui-list-item-title">' + data.data[i]['remark'] + '</div><div class="mdui-list-item-text mdui-list-item-one-line mdui-hidden">暂不支持个性签名</div></div></li');
            }
          }
          delete data;
        }
      });
    }

    // TODO : 获取好友分组功能待完成

    function get_group_list() {
      $.ajax({
        method: 'POST',
        url: http + '/get_group_list',
        data: {
          params: ''
        },
        success: function (data) {
          data = JSON.parse(data);
          console.log(data);
          if (data.status === 'ok') {
            $('#group-list').empty();
            for (let i in data.data) {
              $('#group-list').append('<li class="mdui-list-item mdui-ripple"><div class="mdui-list-item-avatar"><img src="' + getGroupLogo(data.data[i]['group_id']) + '" /></div><div class="mdui-list-item-content"><div class="mdui-list-item-title">' + data.data[i]['group_name'] + '</div></div></li');
              mdui.mutation();
            }
          }
          delete data;
        }
      });
    }
  </script>
  <script>
    ws.addEventListener('close', function (event) {
      errConnect();
    });

    $('#sidebar_button').on('click', function (e) {
      console.clear();
      get_login_info();
    });

    ws.addEventListener('open', function (event) {
      if ($('#chat-list').children().length === 0) {
        // TODO: 初始化聊天列表
        console.clear();
      }
    });

    $('#people_button').on('click', function (e) {
      if ($('#friend-list').children().length === 0) {
        console.clear();
        get_friend_list();
        get_system_msg();
      } else {
        console.clear();
        get_system_msg();
      }
    });

    $('#friend_button').on('click', function (e) {
      console.clear();
      get_friend_list();
    });

    // TODO : 好友分组功能待完成

    $('#group_button').on('click', function (e) {
      console.clear();
      get_group_list();
    });

    // TODO ：QQ 空间

    // Debug
    ws.addEventListener('message', function (event) {
      data = JSON.parse(event.data);
      switch (data['post_type']) {
        case 'message':
          console.log(data);
          break;

        default:
          console.log(data);
          break;
      }
    });
  </script>
</body>
</html>
